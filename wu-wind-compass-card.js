"use strict";var DEG2RAD=Math.PI/180,I18N={en:{card8:["N","NE","E","SE","S","SW","W","NW"],card16:["N","NNE","NE","ENE","E","ESE","SE","SSE","S","SSW","SW","WSW","W","WNW","NW","NNW"]},cs:{card8:["S","SV","V","JV","J","JZ","Z","SZ"],card16:["S","SSV","SV","VSV","V","VJV","JV","JJV","J","JJZ","JZ","ZJZ","Z","ZSZ","SZ","SSZ"]}};class WuWindCompassCard extends HTMLElement{constructor(){super(),this._config=null,this._hass=null,this._lastDir=null,this._lang="en",this.attachShadow({mode:"open"})}static get version(){return"1.4.0"}static async getConfigElement(){return document.createElement("wu-wind-compass-card-editor")}static getStubConfig(e,t){let s=(e,t)=>(e||[]).find(e=>t(e))||"",n=s(t,e=>e.endsWith("_bearing")||e.includes("wind")&&e.includes("dir"))||"",i=s(t,e=>e.includes("wind")&&(e.includes("speed")||e.endsWith("_spd")))||"";return{entity_direction:n,entity_speed:i||void 0,size:220,wedge_width_deg:22.5}}setConfig(e){if(!e||!e.entity_direction)throw Error("entity_direction is required");this._config={name:e.name||"Wind",entity_direction:e.entity_direction,entity_speed:e.entity_speed||null,speed_unit:e.speed_unit||null,show_speed:!1!==e.show_speed,size:Number(e.size||220),language:e.language||null,outer_stroke:e.outer_stroke||"var(--ha-card-border-color, rgba(127,127,127,0.35))",segment_color:e.segment_color||"rgba(3, 169, 244, 0.18)",label_color:e.label_color||"var(--secondary-text-color)",center_text_color:e.center_text_color||"var(--primary-text-color)",wedge_color:e.wedge_color||"var(--accent-color)",wedge_width_deg:Number(e.wedge_width_deg||22.5),smooth_deg:Number(e.smooth_deg||0),font_labels_px:Number(e.font_labels_px||14),font_center_px:Number(e.font_center_px||28),font_speed_px:Number(e.font_speed_px||13)},this._build()}getCardSize(){return 3}set hass(e){if(this._hass=e,this._config){var t=this._resolveLang();t!==this._lang&&(this._lang=t,this._renderLabels());var s=e.states[this._config.entity_direction],n=this._config.entity_speed?e.states[this._config.entity_speed]:null,i=this._parseNumber(s&&s.state),a=n?this._parseNumber(n.state):null,r=null!=i&&isFinite(i)?(i%360+360)%360:null,o=r;this._config.smooth_deg&&null!=this._lastDir&&null!=r&&Math.abs(this._angleDelta(this._lastDir,r))<this._config.smooth_deg&&(o=this._lastDir),null!=o&&(this._lastDir=o),this._update(o,a)}}_resolveLang(){var e=this._config&&this._config.language?String(this._config.language).toLowerCase():null,t=this._hass&&(this._hass.language||this._hass.locale&&this._hass.locale.language),s=navigator&&navigator.language?navigator.language:"en",n=(e||t||s||"en").slice(0,2).toLowerCase();return I18N[n]?n:"en"}_parseNumber(e){if(null==e)return null;var t=Number(e);return isNaN(t)?null:t}_angleDelta(e,t){return(t-e+540)%360-180}_cardinal16(e){return null!=e&&isFinite(e)?(!1,(I18N[this._lang]||I18N.en).card16[Math.floor((e+11.25)%360/22.5)]):"—"}_formatSpeed(e){if(null==e||!isFinite(e))return"";var t=this._config.speed_unit;if(!t&&this._hass&&this._config.entity_speed){var s=this._hass.states[this._config.entity_speed];s&&s.attributes&&s.attributes.unit_of_measurement&&(t=s.attributes.unit_of_measurement)}return Math.round(10*e)/10+(t?" "+t:"")}_polar(e,t,s,n){var i=n*DEG2RAD;return[e+s*Math.sin(i),t-s*Math.cos(i)]}_arcPath(e,t,s,n,i){var a=this._polar(e,t,s,n),r=this._polar(e,t,s,i);return"M "+a[0]+" "+a[1]+" A "+s+" "+s+" 0 "+((i-n+360)%360>180?1:0)+" 1 "+r[0]+" "+r[1]}_build(){var e=this._config.size,t=e/2,s=t-18,n=document.createElement("ha-card");this._config.name&&(n.header=this._config.name);var i=document.createElement("style");i.textContent=`
      :host { display: block; }
      ha-card { padding: 8px 8px 6px; }
      .wrap { position: relative; margin: 0 auto; height:${e}px; width:${e}px; }
      svg { overflow: visible; }
      .outer { fill: none; stroke: ${this._config.outer_stroke}; stroke-width: 2; }
      .segment { fill: none; stroke: ${this._config.segment_color}; stroke-linecap: round; stroke-width: 16; }
      .labels { fill: ${this._config.label_color}; font-size: ${this._config.font_labels_px}px; font-weight: 600; }
      .centerText { fill: ${this._config.center_text_color}; font-size: ${this._config.font_center_px}px; font-weight: 700; text-anchor: middle; dominant-baseline: middle; }
      .speed { fill: var(--secondary-text-color); font-size: ${this._config.font_speed_px}px; text-anchor: middle; dominant-baseline: hanging; }
      .wedge { fill: ${this._config.wedge_color}; opacity: 1; }
    `;var a=document.createElement("div");a.className="wrap";var r="http://www.w3.org/2000/svg",o=document.createElementNS(r,"svg");o.setAttribute("viewBox","0 0 "+e+" "+e);var l=document.createElementNS(r,"circle");l.setAttribute("cx",t),l.setAttribute("cy",t),l.setAttribute("r",t-6),l.setAttribute("class","outer"),o.appendChild(l);for(var d=document.createElementNS(r,"g"),c=0;c<4;c++){var h=90*c+6,u=(c+1)*90-6,p=this._arcPath(t,t,s,h,u),g=document.createElementNS(r,"path");g.setAttribute("d",p),g.setAttribute("class","segment"),d.appendChild(g)}o.appendChild(d);var m=document.createElementNS(r,"path");m.setAttribute("class","wedge"),o.appendChild(m);var f=document.createElementNS(r,"g");f.setAttribute("class","labels"),o.appendChild(f);var b=document.createElementNS(r,"text");b.setAttribute("x",t),b.setAttribute("y",t),b.setAttribute("class","centerText"),b.textContent="—",o.appendChild(b);var x=document.createElementNS(r,"text");x.setAttribute("x",t),x.setAttribute("y",t+.65*this._config.font_center_px),x.setAttribute("class","speed"),x.textContent="",this._config.show_speed&&o.appendChild(x),a.appendChild(o),n.appendChild(i),n.appendChild(a),this._els={r:t,innerBandR:s,bandWidth:16,wedge:m,center:b,speedT:x,labelsG:f},this.shadowRoot.innerHTML="",this.shadowRoot.appendChild(n),this._lang=this._resolveLang(),this._renderLabels()}_renderLabels(){if(this._els){for(var e=this._els.r,t=this._els.innerBandR,s=this._els.labelsG;s.firstChild;)s.removeChild(s.firstChild);for(var n=(I18N[this._lang]||I18N.en).card8,i=[0,45,90,135,180,225,270,315],a=0;a<8;a++){var r=n[a],o=i[a],l=this._polar(e,e,t,o),d=document.createElementNS("http://www.w3.org/2000/svg","text");d.setAttribute("x",l[0]),d.setAttribute("y",l[1]+2),d.setAttribute("text-anchor","middle"),d.textContent=r,s.appendChild(d)}}}_update(e,t){if(this._els){var s=this._els.r,n=this._els.innerBandR,i=this._els.bandWidth,a=this._els.wedge,r=this._els.center,o=this._els.speedT;if(null==e||!isFinite(e)){r.textContent="—",o&&(o.textContent=""),a.setAttribute("d","");return}var l=this._config.wedge_width_deg,d=n-.45*i,c=this._polar(s,s,d,e-l/2),h=this._polar(s,s,n+.8*i,e),u=this._polar(s,s,d,e+l/2),p="M "+c[0]+" "+c[1]+" L "+h[0]+" "+h[1]+" L "+u[0]+" "+u[1]+" Z";a.setAttribute("d",p);var g=this._cardinal16(e);r.textContent=g,o&&(o.textContent=this._formatSpeed(t))}}}if(!customElements.get("wu-wind-compass-card")){customElements.define("wu-wind-compass-card",WuWindCompassCard);try{console.info("%cWU Wind Compass Card loaded v"+WuWindCompassCard.version,"color:#03a9f4")}catch(e){}}window.customCards=window.customCards||[],window.customCards.push({type:"wu-wind-compass-card",name:"WU Wind Compass Card",description:"Compass-style wind direction card with wedge & segmented band. i18n: en, cs"});class WuWindCompassCardEditor extends HTMLElement{constructor(){super(),this._helpers=null,this._hass=null,this._config={},this.attachShadow({mode:"open"})}set hass(e){this._hass=e,this._render()}setConfig(e){this._config={...e},"auto"===this._config.language&&delete this._config.language,this._render()}connectedCallback(){this._load()}async _load(){if(window.loadCardHelpers)try{this._helpers=await window.loadCardHelpers()}catch(e){}this._render()}_schema(){return[{name:"name",selector:{text:{}}},{name:"entity_direction",required:!0,selector:{entity:{domain:"sensor"}}},{name:"entity_speed",selector:{entity:{domain:"sensor"}}},{name:"language",selector:{select:{mode:"dropdown",options:[{value:"auto",label:"Auto (HA language)"},{value:"cs",label:"Čeština"},{value:"en",label:"English"},]}}},{name:"size",selector:{number:{min:140,max:480,step:10,mode:"slider"}}},{name:"wedge_width_deg",selector:{number:{min:5,max:90,step:2.5,mode:"slider"}}},{name:"smooth_deg",selector:{number:{min:0,max:30,step:1,mode:"slider"}}},{name:"font_center_px",selector:{number:{min:16,max:48,step:1,mode:"box"}}},{name:"font_labels_px",selector:{number:{min:10,max:30,step:1,mode:"box"}}},{name:"font_speed_px",selector:{number:{min:10,max:24,step:1,mode:"box"}}},{name:"wedge_color",selector:{text:{}}},{name:"segment_color",selector:{text:{}}},{name:"outer_stroke",selector:{text:{}}},{name:"label_color",selector:{text:{}}},{name:"center_text_color",selector:{text:{}}},]}_render(){if(!this.shadowRoot)return;this.shadowRoot.innerHTML="";let e=document.createElement("style");e.textContent=`
      :host { display:block; }
      ha-form { padding: 0 6px 6px; }
    `;let t=document.createElement("ha-form");t.schema=this._schema(),t.data=this._exportData(this._config),t.hass=this._hass,t.addEventListener("value-changed",e=>{e.stopPropagation();let t=e.detail.value||{},s=this._importData(t);this._config=s,this.dispatchEvent(new CustomEvent("config-changed",{detail:{config:s},bubbles:!0,composed:!0}))}),this.shadowRoot.appendChild(e),this.shadowRoot.appendChild(t)}_exportData(e){let t={...e};return t.language||(t.language="auto"),t}_importData(e){let t={...e};return"auto"===t.language&&delete t.language,t}}customElements.get("wu-wind-compass-card-editor")||customElements.define("wu-wind-compass-card-editor",WuWindCompassCardEditor);